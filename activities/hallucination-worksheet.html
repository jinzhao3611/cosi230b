<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worksheet: LLM Hallucination Detection</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; line-height: 1.5; font-size: 14px; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #d32f2f, #f44336); color: white; padding: 20px; margin-bottom: 20px; }
        header h1 { font-size: 1.5rem; margin-bottom: 8px; }
        header .subtitle { font-size: 0.95rem; opacity: 0.9; }
        header .meta { margin-top: 10px; font-size: 0.85rem; opacity: 0.8; display: flex; gap: 20px; flex-wrap: wrap; }
        header .author { margin-top: 8px; font-size: 0.85rem; opacity: 0.9; }
        .section { background: white; border-radius: 6px; padding: 18px; margin-bottom: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
        .section h2 { color: #d32f2f; font-size: 1.15rem; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0; }
        .section h3 { color: #333; font-size: 1rem; margin: 14px 0 8px 0; }
        .section p { margin-bottom: 8px; }
        .definition-box { background: #ffebee; border-left: 3px solid #f44336; padding: 12px 15px; margin: 12px 0; }
        .response-box { background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin: 12px 0; }
        .response-box .label { font-weight: 600; color: #666; margin-bottom: 8px; font-size: 0.9rem; }
        .claim-item { background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px 12px; margin: 8px 0; display: flex; align-items: flex-start; gap: 10px; }
        .claim-number { background: #d32f2f; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; flex-shrink: 0; }
        .claim-text { flex: 1; }
        .claim-verdict { display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
        .claim-verdict label { display: flex; align-items: center; gap: 4px; font-size: 0.85rem; cursor: pointer; }
        .question-box { background: #fff8e1; border: 1px solid #ffcc02; border-radius: 6px; padding: 14px; margin: 12px 0; }
        .question-box .q-header { font-weight: 600; color: #f57c00; margin-bottom: 10px; }
        .source-box { background: #e3f2fd; border: 1px solid #90caf9; border-radius: 6px; padding: 12px; margin: 12px 0; font-size: 0.9rem; }
        .source-box .source-label { font-weight: 600; color: #1976d2; margin-bottom: 5px; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 6px; margin: 10px 0; }
        .checkbox-option, .radio-option { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.9rem; }
        .checkbox-option input, .radio-option input { width: 16px; height: 16px; cursor: pointer; }
        .radio-options { display: flex; flex-wrap: wrap; gap: 15px; margin: 10px 0; }
        textarea { width: 100%; min-height: 50px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 0.9rem; resize: vertical; margin-top: 4px; }
        textarea:focus { outline: none; border-color: #f44336; }
        .input-group { margin: 10px 0; }
        .input-group label { display: block; font-weight: 500; margin-bottom: 4px; color: #555; font-size: 0.9rem; }
        .choices-container { display: none; margin-top: 10px; }
        .choices-container.show { display: block; }
        .toggle-btn { background: #e0e0e0; border: 1px solid #ccc; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; color: #333; margin-top: 8px; }
        .toggle-btn:hover { background: #d0d0d0; }
        .toggle-btn.active { background: #f44336; color: white; border-color: #f44336; }
        .takeaway-box { background: #e8f5e9; border: 1px solid #a5d6a7; border-radius: 6px; padding: 14px; margin: 12px 0; }
        .takeaway-box h3 { color: #388e3c; margin-bottom: 8px; font-size: 1rem; }
        .takeaway-box ul { margin-left: 18px; font-size: 0.9rem; }
        .takeaway-box li { margin: 4px 0; }
        .hallucination-type { background: #fff3e0; border-left: 3px solid #ff9800; padding: 10px 12px; margin: 8px 0; font-size: 0.9rem; }
        .toolbar { position: fixed; bottom: 15px; right: 15px; display: flex; gap: 8px; }
        .toolbar button { padding: 10px 16px; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
        .btn-print { background: #f44336; color: white; }
        .btn-clear { background: #757575; color: white; }
        @media print {
            body { background: white; font-size: 12px; }
            .container { padding: 0; }
            header { margin-bottom: 15px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .section { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
            .toolbar { display: none; }
            .choices-container { display: block !important; }
            .toggle-btn { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container" style="padding: 0;">
            <h1>Worksheet: LLM Hallucination Detection</h1>
            <div class="subtitle">Identifying when AI makes things up</div>
            <div class="meta">
                <span><strong>Course:</strong> Natural Language Annotation for Machine Learning</span>
                <span><strong>Task Type:</strong> Factuality verification / Span labeling</span>
            </div>
            <div class="author"><strong>Author:</strong> Jin Zhao</div>
        </div>
    </header>

    <div class="container">
        <section class="section">
            <h2>Background</h2>
            <p>Large Language Models sometimes generate content that sounds plausible but is factually incorrect. This is called <strong>hallucination</strong>.</p>

            <div class="definition-box">
                <p><strong>Hallucination:</strong> AI-generated content that is nonsensical, unfaithful to the source, or factually incorrect, presented with apparent confidence.</p>
            </div>

            <h3>Types of Hallucinations</h3>
            <div class="hallucination-type"><strong>Intrinsic:</strong> Output contradicts the source material</div>
            <div class="hallucination-type"><strong>Extrinsic:</strong> Output cannot be verified from the source (may or may not be true)</div>
            <div class="hallucination-type"><strong>Fabrication:</strong> Completely made-up facts (fake citations, non-existent events)</div>

            <h3>Why This Matters</h3>
            <p>Detecting hallucinations is critical for building trustworthy AI systems, especially in high-stakes domains like healthcare, law, and education.</p>
        </section>

        <section class="section">
            <h2>Part 1: Factual Claim Identification</h2>
            <div class="response-box">
                <div class="label">LLM Response (Question: "Tell me about Marie Curie")</div>
                <p>Marie Curie was a Polish-French physicist and chemist who conducted pioneering research on radioactivity. She was born in Warsaw in 1867. She was the first woman to win a Nobel Prize, the first person to win Nobel Prizes in two different sciences (Physics in 1903 and Chemistry in 1911), and the first female professor at the University of Paris. She discovered the elements polonium and radium, and her research contributed to the development of X-ray machines during World War I.</p>
            </div>

            <div class="question-box">
                <div class="q-header">Question 1</div>
                <p>Identify each factual claim in the response and rate its accuracy:</p>

                <div class="claim-item">
                    <div class="claim-number">1</div>
                    <div class="claim-text">
                        "Marie Curie was Polish-French"
                        <div class="claim-verdict">
                            <label><input type="radio" name="c1" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c1" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c1" value="unverifiable"> Unverifiable</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">2</div>
                    <div class="claim-text">
                        "Born in Warsaw in 1867"
                        <div class="claim-verdict">
                            <label><input type="radio" name="c2" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c2" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c2" value="unverifiable"> Unverifiable</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">3</div>
                    <div class="claim-text">
                        "First woman to win a Nobel Prize"
                        <div class="claim-verdict">
                            <label><input type="radio" name="c3" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c3" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c3" value="unverifiable"> Unverifiable</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">4</div>
                    <div class="claim-text">
                        "First person to win Nobel Prizes in two different sciences"
                        <div class="claim-verdict">
                            <label><input type="radio" name="c4" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c4" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c4" value="unverifiable"> Unverifiable</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">5</div>
                    <div class="claim-text">
                        "First female professor at the University of Paris"
                        <div class="claim-verdict">
                            <label><input type="radio" name="c5" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c5" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c5" value="unverifiable"> Unverifiable</label>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>How did you verify these claims? What resources would you need?</label>
                    <textarea placeholder="Describe your verification process..."></textarea>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 2: Grounded vs. Ungrounded Claims</h2>
            <div class="source-box">
                <div class="source-label">Source Document:</div>
                <p>"The 2024 Paris Olympics featured 32 sports. The opening ceremony took place along the Seine River on July 26, 2024. Over 10,000 athletes participated from 206 countries."</p>
            </div>

            <div class="response-box">
                <div class="label">LLM Summary:</div>
                <p>The 2024 Paris Olympics included 32 sports with over 10,000 athletes from 206 nations. The spectacular opening ceremony was held on July 26, 2024, along the Seine River, featuring stunning light shows and performances by famous French artists. It was considered one of the most innovative opening ceremonies in Olympic history.</p>
            </div>

            <div class="question-box">
                <div class="q-header">Question 2</div>
                <p>Which parts of the summary are grounded in the source vs. hallucinated?</p>
                <button class="toggle-btn" onclick="toggleChoices(this)">Show Choices</button>
                <div class="choices-container">
                    <p style="margin: 10px 0;"><strong>Grounded (in source):</strong></p>
                    <div class="checkbox-grid">
                        <label class="checkbox-option"><input type="checkbox" name="q2a" value="32sports"> 32 sports</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2a" value="10000"> 10,000+ athletes</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2a" value="206"> 206 nations</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2a" value="date"> July 26, 2024</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2a" value="seine"> Seine River</label>
                    </div>
                    <p style="margin: 10px 0;"><strong>Hallucinated (not in source):</strong></p>
                    <div class="checkbox-grid">
                        <label class="checkbox-option"><input type="checkbox" name="q2b" value="spectacular"> "spectacular"</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2b" value="lights"> Light shows</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2b" value="artists"> French artists</label>
                        <label class="checkbox-option"><input type="checkbox" name="q2b" value="innovative"> "most innovative"</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Are the hallucinated parts necessarily false?</label>
                    <textarea placeholder="Discuss the difference between 'not in source' and 'false'..."></textarea>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 3: Subtle Hallucinations</h2>
            <div class="response-box">
                <div class="label">LLM Response (Question: "What did Einstein say about imagination?")</div>
                <p>Einstein famously said, "Imagination is more important than knowledge. Knowledge is limited. Imagination encircles the world." He made this statement in a 1929 interview with George Sylvester Viereck for the Saturday Evening Post, where he discussed his views on creativity and scientific thinking.</p>
            </div>

            <div class="question-box">
                <div class="q-header">Question 3</div>
                <p>This response contains a mix of accurate and potentially hallucinated information. Rate each element:</p>

                <div class="claim-item">
                    <div class="claim-number">1</div>
                    <div class="claim-text">
                        The quote itself
                        <div class="claim-verdict">
                            <label><input type="radio" name="c3_1" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c3_1" value="partial"> Partially accurate</label>
                            <label><input type="radio" name="c3_1" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c3_1" value="unknown"> Unknown</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">2</div>
                    <div class="claim-text">
                        Interview with George Sylvester Viereck
                        <div class="claim-verdict">
                            <label><input type="radio" name="c3_2" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c3_2" value="partial"> Partially accurate</label>
                            <label><input type="radio" name="c3_2" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c3_2" value="unknown"> Unknown</label>
                        </div>
                    </div>
                </div>

                <div class="claim-item">
                    <div class="claim-number">3</div>
                    <div class="claim-text">
                        Published in Saturday Evening Post, 1929
                        <div class="claim-verdict">
                            <label><input type="radio" name="c3_3" value="accurate"> Accurate</label>
                            <label><input type="radio" name="c3_3" value="partial"> Partially accurate</label>
                            <label><input type="radio" name="c3_3" value="inaccurate"> Inaccurate</label>
                            <label><input type="radio" name="c3_3" value="unknown"> Unknown</label>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Why are citation hallucinations particularly dangerous?</label>
                    <textarea placeholder="Discuss the risks of fake citations..."></textarea>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 4: Hallucination Severity</h2>
            <div class="response-box">
                <div class="label">LLM Response (Medical Context):</div>
                <p>"Aspirin is generally safe for most adults. The typical dose for pain relief is 325-650mg every 4-6 hours, not exceeding 4000mg per day. However, aspirin should be avoided by children under 16 due to the risk of Reye's syndrome, and by people with bleeding disorders. It can also interact with blood thinners like warfarin. Always consult a doctor before starting any medication regimen."</p>
            </div>

            <div class="question-box">
                <div class="q-header">Question 4</div>
                <p>Even if most information is accurate, small errors in medical contexts can be dangerous. Assess the severity of potential errors:</p>
                <button class="toggle-btn" onclick="toggleChoices(this)">Show Choices</button>
                <div class="choices-container">
                    <div class="radio-options" style="flex-direction: column; gap: 8px;">
                        <label class="radio-option"><input type="radio" name="q4" value="low"> Low severity: Minor details might be off but core advice is sound</label>
                        <label class="radio-option"><input type="radio" name="q4" value="medium"> Medium severity: Some claims need verification</label>
                        <label class="radio-option"><input type="radio" name="q4" value="high"> High severity: Medical advice should not come from unverified AI</label>
                        <label class="radio-option"><input type="radio" name="q4" value="critical"> Critical: Even small errors could cause harm</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>How should hallucination severity affect annotation guidelines?</label>
                    <textarea placeholder="Should domain determine annotation strictness?"></textarea>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 5: Self-Contradictory Hallucinations</h2>
            <div class="response-box">
                <div class="label">LLM Response:</div>
                <p>"The Eiffel Tower was completed in 1889 for the World's Fair. It took two years and two months to build, with construction starting in 1887. The tower stands at 324 meters (1,063 feet) tall, making it the tallest structure in Paris. When it was first built, it was 300 meters tall, but the addition of broadcasting antennas increased its height. The tower was originally designed as a temporary structure for the 1889 World's Fair, but it was so popular that it was kept permanently."</p>
            </div>

            <div class="question-box">
                <div class="q-header">Question 5</div>
                <p>This response may contain internal contradictions. Can you identify any?</p>
                <div class="input-group">
                    <textarea placeholder="List any contradictions or inconsistencies you notice..."></textarea>
                </div>
                <p style="margin-top: 10px;">How should self-contradictory responses be labeled?</p>
                <button class="toggle-btn" onclick="toggleChoices(this)">Show Choices</button>
                <div class="choices-container">
                    <div class="radio-options" style="flex-direction: column; gap: 8px;">
                        <label class="radio-option"><input type="radio" name="q5" value="both"> Mark both contradicting claims as hallucinations</label>
                        <label class="radio-option"><input type="radio" name="q5" value="verify"> Verify which is correct, mark only the false one</label>
                        <label class="radio-option"><input type="radio" name="q5" value="flag"> Flag as "self-contradictory" without fact-checking</label>
                        <label class="radio-option"><input type="radio" name="q5" value="reject"> Reject the entire response</label>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 6: Group Discussion</h2>
            <div class="question-box">
                <div class="q-header">Question 6</div>
                <p>Compare your annotations with your group. Where did you disagree?</p>
                <button class="toggle-btn" onclick="toggleChoices(this)">Show Choices</button>
                <div class="choices-container">
                    <div class="checkbox-grid">
                        <label class="checkbox-option"><input type="checkbox" name="q6" value="boundary"> Claim boundaries</label>
                        <label class="checkbox-option"><input type="checkbox" name="q6" value="grounded"> What counts as "grounded"</label>
                        <label class="checkbox-option"><input type="checkbox" name="q6" value="severity"> Hallucination severity</label>
                        <label class="checkbox-option"><input type="checkbox" name="q6" value="verify"> How to verify claims</label>
                        <label class="checkbox-option"><input type="checkbox" name="q6" value="extrinsic"> Extrinsic hallucination handling</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Describe one specific disagreement:</label>
                    <textarea placeholder="What caused the disagreement?"></textarea>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Part 7: Reflection</h2>
            <div class="question-box">
                <div class="q-header">Question 7</div>
                <p>Why is hallucination detection difficult?</p>
                <button class="toggle-btn" onclick="toggleChoices(this)">Show Choices</button>
                <div class="choices-container">
                    <div class="checkbox-grid">
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="knowledge"> Requires extensive world knowledge</label>
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="plausible"> Hallucinations sound plausible</label>
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="sources"> Sources may also be wrong</label>
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="partial"> Claims can be partially true</label>
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="granularity"> Granularity of claims varies</label>
                        <label class="checkbox-option"><input type="checkbox" name="q7" value="all"> All of the above</label>
                    </div>
                </div>
            </div>

            <div class="takeaway-box">
                <h3>Key Takeaway</h3>
                <p><strong>Hallucination detection requires both knowledge and judgment about what level of error matters.</strong></p>
                <ul>
                    <li>Not all unverifiable claims are false; not all false claims are equally harmful</li>
                    <li>Context determines severity (medical vs. creative writing)</li>
                    <li>The line between "embellishment" and "fabrication" is fuzzy</li>
                    <li>Annotation guidelines must balance thoroughness with practicality</li>
                </ul>
            </div>
        </section>
    </div>

    <div class="toolbar">
        <button class="btn-clear" onclick="clearForm()">Clear All</button>
        <button class="btn-print" onclick="window.print()">Print / Save PDF</button>
    </div>

    <script>
        function toggleChoices(btn) {
            const container = btn.nextElementSibling;
            container.classList.toggle('show');
            btn.classList.toggle('active');
            btn.textContent = container.classList.contains('show') ? 'Hide Choices' : 'Show Choices';
        }

        function clearForm() {
            if (confirm('Clear all answers?')) {
                document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(i => i.checked = false);
                document.querySelectorAll('textarea').forEach(i => i.value = '');
                document.querySelectorAll('.choices-container').forEach(c => c.classList.remove('show'));
                document.querySelectorAll('.toggle-btn').forEach(b => { b.classList.remove('active'); b.textContent = 'Show Choices'; });
                localStorage.removeItem('hallucination-worksheet');
            }
        }

        function saveProgress() {
            const data = { radios: {}, checkboxes: {}, textareas: [] };
            document.querySelectorAll('input[type="radio"]:checked').forEach(r => data.radios[r.name] = r.value);
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(c => {
                if (!data.checkboxes[c.name]) data.checkboxes[c.name] = [];
                data.checkboxes[c.name].push(c.value);
            });
            document.querySelectorAll('textarea').forEach((t, i) => data.textareas[i] = t.value);
            localStorage.setItem('hallucination-worksheet', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem('hallucination-worksheet');
            if (!saved) return;
            try {
                const data = JSON.parse(saved);
                Object.entries(data.radios || {}).forEach(([name, value]) => {
                    const r = document.querySelector(`input[type="radio"][name="${name}"][value="${value}"]`);
                    if (r) r.checked = true;
                });
                Object.entries(data.checkboxes || {}).forEach(([name, values]) => {
                    values.forEach(v => {
                        const c = document.querySelector(`input[type="checkbox"][name="${name}"][value="${v}"]`);
                        if (c) c.checked = true;
                    });
                });
                document.querySelectorAll('textarea').forEach((t, i) => { if (data.textareas?.[i]) t.value = data.textareas[i]; });
            } catch (e) { console.error('Error loading:', e); }
        }

        document.addEventListener('DOMContentLoaded', loadProgress);
        document.addEventListener('change', saveProgress);
        document.addEventListener('input', saveProgress);
    </script>

    <!-- Classroom Response System -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="classroom-submit.js"></script>

</body>
</html>
